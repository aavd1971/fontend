!function(global,factory){"object"==typeof exports&&exports?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(global.Mustache={})}(this,function(mustache){function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function testRegExp(re,string){return RegExp_test.call(re,string)}function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function parseTemplate(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tags){if("string"==typeof tags&&(tags=tags.split(spaceRe,2)),!isArray(tags)||2!==tags.length)throw new Error("Invalid tags: "+tags);openingTagRe=new RegExp(escapeRegExp(tags[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tags[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tags[1]))}if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;valueLength>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=[type,value,start,scanner.pos],tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(openSection=sections.pop(),!openSection)throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;numTokens>i;++i)token=tokens[i],token&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}function nestTokens(tokens){for(var token,section,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;numTokens>i;++i)switch(token=tokens[i],token[0]){case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":section=sections.pop(),section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=view,this.cache={".":this.view},this.parent=parentContext}function Writer(){this.cache={}}var Object_toString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===Object_toString.call(object)},RegExp_test=RegExp.prototype.test,nonSpaceRe=/\S/,entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value,cache=this.cache;if(name in cache)value=cache[name];else{for(var names,index,context=this,lookupHit=!1;context;){if(name.indexOf(".")>0)for(value=context.view,names=name.split("."),index=0;null!=value&&index<names.length;)index===names.length-1&&null!=value&&(lookupHit="object"==typeof value&&value.hasOwnProperty(names[index])),value=value[names[index++]];else null!=context.view&&"object"==typeof context.view&&(value=context.view[name],lookupHit=context.view.hasOwnProperty(name));if(lookupHit)break;context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,tokens=cache[template];return null==tokens&&(tokens=cache[template]=parseTemplate(template,tags)),tokens},Writer.prototype.render=function(template,view,partials){var tokens=this.parse(template),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate){for(var token,symbol,value,buffer="",i=0,numTokens=tokens.length;numTokens>i;++i)value=void 0,token=tokens[i],symbol=token[0],"#"===symbol?value=this._renderSection(token,context,partials,originalTemplate):"^"===symbol?value=this._renderInverted(token,context,partials,originalTemplate):">"===symbol?value=this._renderPartial(token,context,partials,originalTemplate):"&"===symbol?value=this._unescapedValue(token,context):"name"===symbol?value=this._escapedValue(token,context):"text"===symbol&&(value=this._rawValue(token)),void 0!==value&&(buffer+=value);return buffer},Writer.prototype._renderSection=function(token,context,partials,originalTemplate){function subRender(template){return self.render(template,context,partials)}var self=this,buffer="",value=context.lookup(token[1]);if(value){if(isArray(value))for(var j=0,valueLength=value.length;valueLength>j;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"==typeof value||"string"==typeof value||"number"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender),null!=value&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);return buffer}},Writer.prototype._renderInverted=function(token,context,partials,originalTemplate){var value=context.lookup(token[1]);return!value||isArray(value)&&0===value.length?this.renderTokens(token[4],context,partials,originalTemplate):void 0},Writer.prototype._renderPartial=function(token,context,partials){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];return null!=value?this.renderTokens(this.parse(value),context,partials,value):void 0}},Writer.prototype._unescapedValue=function(token,context){var value=context.lookup(token[1]);return null!=value?value:void 0},Writer.prototype._escapedValue=function(token,context){var value=context.lookup(token[1]);return null!=value?mustache.escape(value):void 0},Writer.prototype._rawValue=function(token){return token[1]},mustache.name="mustache.js",mustache.version="2.0.0",mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials){return defaultWriter.render(template,view,partials)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);return isFunction(send)?void send(result):result},mustache.escape=escapeHtml,mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer}),$(function(){function setOption(obj){var str="";obj.items.forEach(function(e){str+='<option name="'+e.name+'">'+e.name+"</option>"}),$("select#"+obj.name).append(str)}function sumTotal(){var formMain=$("#formMain"),sumTotal=formMain.find('[name="Total[]"]'),s=0;sumTotal.each(function(i,e){s+=parseFloat($(e).val())}),$("#inputTotal").val(s.toFixed(2))}function temp_render(){var recordList=$("#recordList"),formModal=$("#formModal"),Description=formModal.find('[name="Description"]').val(),UnitPrice=formModal.find('[name="UnitPrice"]').val(),Quantity=formModal.find('[name="Quantity"]').val(),TotalPrice=formModal.find('[name="TotalPrice"]').val(),VAT=formModal.find('[name="VAT"]').val(),VATAmount=formModal.find('[name="VATAmount"]').val(),Total=formModal.find('[name="Total"]').val(),ar={Description:Description,UnitPrice:UnitPrice,Quantity:Quantity,TotalPrice:TotalPrice,VAT:VAT,VATAmount:VATAmount,Total:Total},template=$("#tempRecordRow").html(),rendered=Mustache.render(template,ar);recordList.find("tbody").append(rendered)}var Article={name:"Article",items:[{name:"item1",params:{Description:"d1",UnitPrice:1,Quantity:2,TotalPrice:2,VAT:5,VATAmount:.1,Total:2.1}},{name:"item2",params:{Description:"d2",UnitPrice:10,Quantity:20,TotalPrice:200,VAT:5,VATAmount:60,Total:260}}]},Company={name:"Company",items:[{name:"item1",params:{Name:"c1",Adress:"a1",City:"ci1",PostalCode:1,VAT:2,FiscalCode:3}},{name:"item2",params:{Name:"c2",Adress:"a2",City:"ci2",PostalCode:10,VAT:20,FiscalCode:30}}]},Client={name:"Client",items:[{name:"item1",params:{Name:"c1",Adress:"a1",City:"ci1",PostalCode:1,VAT:2,FiscalCode:3}},{name:"item2",params:{Name:"c2",Adress:"a2",City:"ci2",PostalCode:10,VAT:20,FiscalCode:30}}]};!function(){setOption(Company),setOption(Client),setOption(Article)}(),$("form").validator(),$("#formMain select").on("change",function(e){function setValue(param1,param2){var formMain=$("#formMain");param2="Company"===param2?"":param2;formMain.find('[name="Name'+param2+'"]').val(param1.Name),formMain.find('[name="Adress'+param2+'"]').val(param1.Adress),formMain.find('[name="City'+param2+'"]').val(param1.City),formMain.find('[name="PostalCode'+param2+'"]').val(param1.PostalCode),formMain.find('[name="VAT'+param2+'"]').val(param1.VAT),formMain.find('[name="FiscalCode'+param2+'"]').val(param1.FiscalCode)}e.preventDefault();var select=$(this).val(),obj="Company"===$(this).attr("id")?Company:Client;obj.items.forEach(function(e){e.name===select&&setValue(e.params,obj.name)})}),$("#Load").on("click",function(e){function setValue(params){{var formModal=$("#formModal");formModal.find('[name="Description"]').val(params.Description),formModal.find('[name="UnitPrice"]').val(params.UnitPrice),formModal.find('[name="Quantity"]').val(params.Quantity),formModal.find('[name="TotalPrice"]').val(params.TotalPrice),formModal.find('[name="VAT"]').val(params.VAT),formModal.find('[name="VATAmount"]').val(params.VATAmount),formModal.find('[name="Total"]').val(params.Total)}}e.preventDefault();var select=$("select#Article").val();Article.items.forEach(function(e){e.name===select&&setValue(e.params)})}),$("#formMain").delegate("input","change",function(){var tr=$(this).closest("tr"),UnitPrice=tr.find('[name="UnitPrice[]"]').val()||0,Quantity=tr.find('[name="Quantity[]"]').val()||0,VAT=tr.find('[name="VAT[]"]').val()||0,TotalPrice=UnitPrice*Quantity,VATAmount=TotalPrice*VAT/100,Total=TotalPrice+VATAmount;tr.find('[name="TotalPrice[]"]').val(parseFloat(TotalPrice).toFixed(2)),tr.find('[name="VATAmount[]"]').val(parseFloat(VATAmount).toFixed(2)),tr.find('[name="Total[]"]').val(parseFloat(Total).toFixed(2)),sumTotal()}),$("#formModal input").on("change",function(){var formModal=$("#formModal"),UnitPrice=formModal.find('[name="UnitPrice"]').val()||0,Quantity=formModal.find('[name="Quantity"]').val()||0,VAT=formModal.find('[name="VAT"]').val()||0,TotalPrice=UnitPrice*Quantity,VATAmount=TotalPrice*VAT/100,Total=TotalPrice+VATAmount;formModal.find('[name="TotalPrice"]').val(parseFloat(TotalPrice).toFixed(2)),formModal.find('[name="VATAmount"]').val(parseFloat(VATAmount).toFixed(2)),formModal.find('[name="Total"]').val(parseFloat(Total).toFixed(2))}),$("#AddNewRow").on("click",function(e){{var formModal=$("#formModal");formModal.find('[name="Description"]').val(""),formModal.find('[name="UnitPrice"]').val(""),formModal.find('[name="Quantity"]').val(""),formModal.find('[name="TotalPrice"]').val("0.0"),formModal.find('[name="VAT"]').val(""),formModal.find('[name="VATAmount"]').val("0.0"),formModal.find('[name="Total"]').val("0.0")}e.preventDefault(),$("#myModal").modal("show")}),$("#recordList").delegate(".removeRow","click",function(e){e.preventDefault(),$(this).closest("tr").remove(),sumTotal()}),$("#Send").on("click",function(){var that=$(this),form=that.closest("form"),ar=form.serializeArray();console.log("ar:",ar)}),$("#Add").on("click",function(e){e.preventDefault(),temp_render(),sumTotal(),$("#cancel").click()})}),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b),f=c.data("bs.validator");(f||"destroy"!=b)&&(f||c.data("bs.validator",f=new d(this,e)),"string"==typeof b&&f[b]())})}var c=':input:not([type="submit"], button):enabled:visible',d=function(b,c){this.$element=a(b),this.options=c,c.errors=a.extend({},d.DEFAULTS.errors,c.errors);for(var e in c.custom)if(!c.errors[e])throw new Error("Missing default error message for custom validator: "+e);a.extend(d.VALIDATORS,c.custom),this.$element.attr("novalidate",!0),this.toggleSubmit(),this.$element.on("input.bs.validator change.bs.validator focusout.bs.validator",a.proxy(this.validateInput,this)),this.$element.on("submit.bs.validator",a.proxy(this.onSubmit,this)),this.$element.find("[data-match]").each(function(){var b=a(this),c=b.data("match");a(c).on("input.bs.validator",function(){b.val()&&b.trigger("input.bs.validator")})})};d.DEFAULTS={delay:500,html:!1,disable:!0,custom:{},errors:{match:"Does not match",minlength:"Not long enough"}},d.VALIDATORS={"native":function(a){var b=a[0];return b.checkValidity?b.checkValidity():!0},match:function(b){var c=b.data("match");return!b.val()||b.val()===a(c).val()},minlength:function(a){var b=a.data("minlength");return!a.val()||a.val().length>=b}},d.prototype.validateInput=function(b){var c=a(b.target),d=c.data("bs.validator.errors");if(c.is('[type="radio"]')&&(c=this.$element.find('input[name="'+c.attr("name")+'"]')),this.$element.trigger(b=a.Event("validate.bs.validator",{relatedTarget:c[0]})),!b.isDefaultPrevented()){var e=this;this.runValidators(c).done(function(f){c.data("bs.validator.errors",f),f.length?e.showErrors(c):e.clearErrors(c),d&&f.toString()===d.toString()||(b=f.length?a.Event("invalid.bs.validator",{relatedTarget:c[0],detail:f}):a.Event("valid.bs.validator",{relatedTarget:c[0],detail:d}),e.$element.trigger(b)),e.toggleSubmit(),e.$element.trigger(a.Event("validated.bs.validator",{relatedTarget:c[0]}))})}},d.prototype.runValidators=function(b){function c(a){return b.data(a+"-error")||b.data("error")||"native"==a&&b[0].validationMessage||g.errors[a]}var e=[],f=a.Deferred(),g=this.options;return b.data("bs.validator.deferred")&&b.data("bs.validator.deferred").reject(),b.data("bs.validator.deferred",f),a.each(d.VALIDATORS,a.proxy(function(a,d){if((b.data(a)||"native"==a)&&!d.call(this,b)){var f=c(a);!~e.indexOf(f)&&e.push(f)}},this)),!e.length&&b.val()&&b.data("remote")?this.defer(b,function(){var d={};d[b.attr("name")]=b.val(),a.get(b.data("remote"),d).fail(function(a,b,d){e.push(c("remote")||d)}).always(function(){f.resolve(e)})}):f.resolve(e),f.promise()},d.prototype.validate=function(){var a=this.options.delay;return this.options.delay=0,this.$element.find(c).trigger("input.bs.validator"),this.options.delay=a,this},d.prototype.showErrors=function(b){var c=this.options.html?"html":"text";this.defer(b,function(){var d=b.closest(".form-group"),e=d.find(".help-block.with-errors"),f=d.find(".form-control-feedback"),g=b.data("bs.validator.errors");g.length&&(g=a("<ul/>").addClass("list-unstyled").append(a.map(g,function(b){return a("<li/>")[c](b)})),void 0===e.data("bs.validator.originalContent")&&e.data("bs.validator.originalContent",e.html()),e.empty().append(g),d.addClass("has-error"),f.length&&f.removeClass("glyphicon-ok")&&f.addClass("glyphicon-warning-sign")&&d.removeClass("has-success"))})},d.prototype.clearErrors=function(a){var b=a.closest(".form-group"),c=b.find(".help-block.with-errors"),d=b.find(".form-control-feedback");c.html(c.data("bs.validator.originalContent")),b.removeClass("has-error"),d.length&&d.removeClass("glyphicon-warning-sign")&&d.addClass("glyphicon-ok")&&b.addClass("has-success")},d.prototype.hasErrors=function(){function b(){return!!(a(this).data("bs.validator.errors")||[]).length}return!!this.$element.find(c).filter(b).length},d.prototype.isIncomplete=function(){function b(){return"checkbox"===this.type?!this.checked:"radio"===this.type?!a('[name="'+this.name+'"]:checked').length:""===a.trim(this.value)}return!!this.$element.find(c).filter("[required]").filter(b).length},d.prototype.onSubmit=function(a){this.validate(),(this.isIncomplete()||this.hasErrors())&&a.preventDefault()},d.prototype.toggleSubmit=function(){if(this.options.disable){var b=a('button[type="submit"], input[type="submit"]').filter('[form="'+this.$element.attr("id")+'"]').add(this.$element.find('input[type="submit"], button[type="submit"]'));b.toggleClass("disabled",this.isIncomplete()||this.hasErrors()).css({"pointer-events":"all",cursor:"pointer"})}},d.prototype.defer=function(a,b){return this.options.delay?(window.clearTimeout(a.data("bs.validator.timeout")),void a.data("bs.validator.timeout",window.setTimeout(b,this.options.delay))):b()},d.prototype.destroy=function(){return this.$element.removeAttr("novalidate").removeData("bs.validator").off(".bs.validator"),this.$element.find(c).off(".bs.validator").removeData(["bs.validator.errors","bs.validator.deferred"]).each(function(){var b=a(this),c=b.data("bs.validator.timeout");window.clearTimeout(c)&&b.removeData("bs.validator.timeout")}),this.$element.find(".help-block.with-errors").each(function(){var b=a(this),c=b.data("bs.validator.originalContent");b.removeData("bs.validator.originalContent").html(c)}),this.$element.find('input[type="submit"], button[type="submit"]').removeClass("disabled"),this.$element.find(".has-error").removeClass("has-error"),this};var e=a.fn.validator;a.fn.validator=b,a.fn.validator.Constructor=d,a.fn.validator.noConflict=function(){return a.fn.validator=e,this},a(window).on("load",function(){a('form[data-toggle="validator"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery);